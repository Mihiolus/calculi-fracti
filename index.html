<html>

<head>
    <meta charset="utf-8">
    <title>Calculi Fracti</title>
    <style>
        input[type="button"] {
            width: 100%;
        }

        .number_field {
            width: 100%;
            text-align: right
        }
    </style>
    <link rel="icon" href="icon.png">
</head>

<body>
    <h1>Calculi Fracti: A Roman fractional calculator</h1>
    <a href="https://github.com/Mihiolus/calculi-fracti">Site created and hosted on GitHub</a>
    <p>You can find out how Romans worked fractions in <a
            href="https://en.wikipedia.org/wiki/Roman_numerals#Fractions">this Wikipedia article</a>.</p>

    <table id="calc" style="width:250px;">
        <tr>
            <td colspan="4" id="operation_roman" class="number_field"></td>
        </tr>
        <tr>
            <td colspan="4" id="operation_arabic" class="number_field"></td>
        </tr>
        <tr>
            <td colspan="4" id="output_roman" class="number_field"></td>
        </tr>
        <tr>
            <td colspan="4" id="output_arabic" class="number_field"></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td><input type="button" value="c" onclick="clr()"></td>
            <td><input type="button" value="←" onclick="backspace()"></td>
        </tr>
        <tr>
            <td><input type="button" value=7 onclick="store('7')"></td>
            <td><input type="button" value=8 onclick="store('8')"></td>
            <td><input type="button" value=9 onclick="store('9')"></td>
            <td><input type="button" value=&#247;></td>
        </tr>
        <tr>
            <td><input type="button" value=4 onclick="store('4')"></td>
            <td><input type="button" value=5 onclick="store('5')"></td>
            <td><input type="button" value=6 onclick="store('6')"></td>
            <td><input type="button" value=&#215;></td>
        </tr>
        <tr>
            <td><input type="button" value=1 onclick="store('1')"></td>
            <td><input type="button" value=2 onclick="store('2')"></td>
            <td><input type="button" value=3 onclick="store('3')"></td>
            <td><input type="button" value=&#8722;></td>
        </tr>
        <tr>
            <td><input type="button" value=0 onclick="store('0')"></td>
            <td><input type="button" value=. onclick="store('.')"></td>
            <td><input type="button" value="=" onclick="convert()"></td>
            <td><input type="button" value="+"></td>
        </tr>
    </table>

    <fieldset style="width: 250px;">
        <legend>Style for large numbers:</legend>

        <div>
            <input type="radio" id="apostr" name="large_style" onclick="change_style('apostr')">
            <label for="apostr">CIↃ IↃↃ CCIↃↃ</label>
        </div>

        <div>
            <input type="radio" id="apostr_tight" name="large_style" onclick="change_style('apostr_tight')">
            <label for="apostr_tight">ↀ ↁ ↂ</label>
        </div>

        <div>
            <input type="radio" id="vincul" name="large_style" onclick="change_style('vincul')" checked>
            <label for="vincul" style="position:relative; top: 2px;"><span style="border-top:1px solid;">I</span> <span
                    style="border-top:1px solid;">V</span> <span style="border-top:1px solid;">X</span></label>
        </div>
    </fieldset>

    <script>
        arabicStr = "";
        large_lookups = {
            apostr: {
                CCIↃↃ: 10000,
                IↃↃ: 5000,
                CIↃ: 1000
            },
            apostr_tight: {
                ↂ: 10000,
                ↁ: 5000,
                ↀ: 1000
            },
            vincul: {
                '<span style="border-top:1px solid;">X</span>': 10000,
                '<span style="border-top:1px solid;">V</span>': 5000,
                '<span style="border-top:1px solid;">I</span>': 1000
            }
        }
        base_lookup = {
            '\u0110': 500,
            'C\u0110': 400,
            C: 100,
            XC: 90,
            L: 50,
            XL: 40,
            X: 10,
            IX: 9,
            V: 5,
            IV: 4,
            I: 1,
            S: 0.5,
            '\u2059': 5 / 12,
            '\u00B7': 1 / 12
        }
        lookup = { ...large_lookups.vincul, ...base_lookup }

        function store(value) {
            update_arabic_output(arabicStr + value)
            convert()
        }
        function change_style(value) {
            lookup = { ...large_lookups[value], ...base_lookup }
            convert()
        }
        function convert() {
            var roman = '',
                i,
                num = arabicStr;
            for (i in lookup) {
                while (num >= lookup[i]) {
                    roman += i;
                    num -= lookup[i];
                }
            }
            document.getElementById("output_roman").innerHTML = roman;
        }
        function clr() {
            document.getElementById("output_roman").innerHTML = ""
            update_arabic_output("")
        }
        function backspace() {
            update_arabic_output(arabicStr.slice(0, -1));
            convert()
        }
        function update_arabic_output(value) {
            arabicStr = value
            document.getElementById("output_arabic").innerHTML = arabicStr;
        }
    </script>
</body>

</html>